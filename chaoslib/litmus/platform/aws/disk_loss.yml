- name: Detaching the disk
  shell: aws ec2 detach-volume --volume-id {{ disk_name }} --region {{ zone_name }}

- name: chaos injection for {{ c_duration }}s
  wait_for:
    timeout: "{{ c_duration }}"

- name: Verify that the disk is connected to node (post)
  include_tasks: "/utils/cloud/aws/status_disk.yml"
  
- block:
  - name: If disk is not attached, it will attach manually
    shell: aws ec2 attach-volume --volume-id {{ disk_name }} --instance-id {{ node_name }} --device {{ device_name }} --region {{ zone_name }}
  when: "inuse == false"