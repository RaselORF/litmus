--- 
- name: Record the cstor-pool pod on given app node
  shell: >
    kubectl get pod -l app=cstor-pool -l openebs.io/storage-pool-claim=cstor-disk-pool -o wide
    -n {{ operator_ns }} | grep {{ instance_name }}
    | awk '{print $1}'
  args:
    executable: /bin/bash
  register: cstor_pool_pod

- name: Fetch AWS instance details
  include_tasks: /common/utils/aws/fetch_aws_details.yml
  when: lookup('env', 'PLATFORM') == 'AWS'
  
- block:

    - name: Detach the disk from the node
      include_tasks: /chaoslib/aws_chaos/ebs_volume_operations.yml
      vars:
        action_on_volume: 'detach'
      when: lookup('env', 'PLATFORM') == 'AWS'

  when: action == "disk-fail"

- block:

    - name: Attach the disk to the node
      include_tasks: /chaoslib/aws_chaos/ebs_volume_operations.yml
      vars:
        action_on_volume: 'attach'
      when: lookup('env', 'PLATFORM') == 'AWS'

  when: action == "disk-recover"


