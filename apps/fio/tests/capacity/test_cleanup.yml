---
- name: Get pvc name to verify successful pvc deletion
  shell: >
    kubectl get pvc {{ test_name }} 
    -o custom-columns=:spec.volumeName -n litmus 
    --no-headers
  args:
    executable: /bin/bash
  register: pv

- name: Confirm fio pod has been deleted
  shell: >
    kubectl get pods -n litmus
  args:
    executable: /bin/bash
  register: result
  until: "'fio_pod_name' not in result.stdout"
  delay: 30
  retries: 12

- block:
    - name: Remove the local persistent volume 
      shell: kubectl delete pv {{ pv.stdout }}
      args:
        executable: /bin/bash
      register: result
      failed_when: "'persistentvolume' and 'deleted' not in result.stdout"
  when: "'openebs-standard' in lookup('env','PROVIDER_STORAGE_CLASS')"
