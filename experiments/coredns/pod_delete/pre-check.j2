{% if l_c_p is defined and l_c_p == 'liveness-checking-pod' %}
- name: Creating an nginx pod
  shell: kubectl run nginx --image=nginx --generator=run-pod/v1 -n {{ c_ns }}

- name: Checking whether application pods are in running state
  shell: kubectl get pod nginx -n default -o custom-columns=:.status.phase --no-headers -n {{ c_ns }}
  register: result
  until: "((result.stdout.split()|unique)|length) == 1 and 'Running' in result.stdout"
  retries: 10

- name: Exposing the nginx pod to port 80
  shell: kubectl expose pod nginx --port 80 -n {{ c_ns }}

- name: Creating a liveness checking pod for continuously checking the service
  shell: >
    kubectl run {{ l_c_p }} --image openebs/tests-custom-client:latest \
                            --env="SERVICE=nginx" --env="INIT_WAIT_DELAY=1" \
                            --env="INIT_RETRY_COUNT=10" --env="LIVENESS_PERIOD_SECONDS=2" \ 
                            --env="LIVENESS_TIMEOUT_SECONDS=1" --env="LIVENESS_RETRY_COUNT=10" \ 
                            --env="PORT=80" --env="INIT_WAIT_DELAY=2" --env="INIT_RETRY_COUNT=10" \
                            --env="LIVENESS_PERIOD_SECONDS=1" --env="LIVENESS_TIMEOUT_SECONDS=3" \
                            --env="LIVENESS_RETRY_COUNT=10" --env="PORT=80" \
                            --env="NAMESPACE={{ c_ns }}" --generator=run-pod/v1 
{% endif %}
